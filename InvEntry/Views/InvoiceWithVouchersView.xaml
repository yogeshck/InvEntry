<UserControl x:Class="InvEntry.Views.InvoiceWithVouchersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:InvEntry.Views"
             xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:viewmodels="clr-namespace:InvEntry.ViewModels"
             xmlns:ext="clr-namespace:InvEntry.Extension"
             d:DataContext="{d:DesignInstance Type=viewmodels:InvoiceWithVouchersViewModel}"
             DataContext="{ext:DISource Type=viewmodels:InvoiceWithVouchersViewModel}"
             xmlns:vm="clr-namespace:InvEntry.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="1100">

    <Grid Width="1300"
          HorizontalAlignment="Left">

        <StackPanel Orientation="Horizontal"
                    Margin="0 0 0 10"
                    Height="28">
            <TextBlock Text="Customer:"
                       VerticalAlignment="Center" />
            <dxe:ComboBoxEdit ItemsSource="{Binding Customers}"
                              SelectedItem="{Binding SelectedCustomer}"
                              DisplayMember="CustomerName"
                              Width="200"
                              Margin="5,0" />
            <TextBlock Text="Invoice Date:"
                       VerticalAlignment="Center"
                       FontSize="15"
                       Margin="20,0" />
            <dxe:DateEdit EditValue="{Binding InvoiceDate}"
                          Width="120" />
            <TextBlock Text="Outstanding: "
                       Margin="20,0" />
            <TextBlock Text="{Binding CustomerOutstanding}"
                       Foreground="Red"
                       FontWeight="Bold" />
        </StackPanel>


        <dxg:GridControl ItemsSource="{Binding Invoices}"
                         AutoGenerateColumns="None">
            <dxg:GridControl.Columns>
                <dxg:GridColumn FieldName="InvNbr"
                                Header="Invoice #"
                                ReadOnly="True"
                                Width="70" />
                <dxg:GridColumn FieldName="InvDate"
                                Header="Date"
                                ReadOnly="True"
                                Width="100" />
                <dxg:GridColumn FieldName="GrossRcbAmount"
                                Header="Total Amount"
                                Width="100">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings MaskType="Numeric"
                                              MaskUseAsDisplayFormat="True"
                                              Mask="C2" />
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="DiscountAmount"
                                Header="Discount"
                                Width="90">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings MaskType="Numeric"
                                              MaskUseAsDisplayFormat="True"
                                              Mask="C2" />
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="AmountPayable"
                                Header="Receivable"
                                Width="120">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings MaskType="Numeric"
                                              MaskUseAsDisplayFormat="True"
                                              Mask="C2" />
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="RecdAmount"
                                Header="Received"
                                Width="120">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings MaskType="Numeric"
                                              MaskUseAsDisplayFormat="True"
                                              Mask="C2" />
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="InvBalance"
                                Header="Balance"
                                Width="100">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings MaskType="Numeric"
                                              MaskUseAsDisplayFormat="True"
                                              Mask="C2" />
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="PaymentDueDate"
                                Header="Due Date"
                                ReadOnly="True"
                                Width="90" />
            </dxg:GridControl.Columns>


            <!-- ✅ Custom layout for two side-by-side grids -->
            <dxg:GridControl.DetailDescriptor>
                <dxg:ContentDetailDescriptor>
                    <dxg:ContentDetailDescriptor.ContentTemplate>
                        <DataTemplate>
                            <Grid Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="20" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Invoice Items -->
                                <dxg:GridControl Grid.Column="0"
                                                 ItemsSource="{Binding InvoiceLines}"
                                                 AutoGenerateColumns="None">
                                    <dxg:GridControl.View>
                                        <dxg:TableView ShowGroupPanel="False" />
                                    </dxg:GridControl.View>
                                    <dxg:GridControl.Columns>
                                        <dxg:GridColumn FieldName="ProductName"
                                                        Header="Product" />
                                        <dxg:GridColumn FieldName="ProdQty"
                                                        Header="Qty" />
                                        <dxg:GridColumn FieldName="InvlBilledPrice"
                                                        Header="Price" />
                                        <dxg:GridColumn FieldName="InvlPayableAmt"
                                                        Header="Amount" />
                                        <dxg:GridColumn FieldName="Amount"
                                                        Header="Amount"
                                                        UnboundType="Decimal"
                                                        UnboundExpression="[Quantity] * [Rate]" />
                                    </dxg:GridControl.Columns>
                                </dxg:GridControl>

                                <!-- Spacer -->
                                <Border Grid.Column="1" />

                                <!-- Vouchers -->
                                <GroupBox Header="Vouchers / Payment">
                                    <dxg:GridControl Grid.Column="2"
                                                     ItemsSource="{Binding Vouchers}"
                                                     AutoGenerateColumns="None">
                                        <dxg:GridControl.View>
                                            <dxg:TableView ShowGroupPanel="False" />
                                        </dxg:GridControl.View>
                                        <dxg:GridControl.Columns>
                                            <dxg:GridColumn FieldName="VoucherType"
                                                            Header="Type" />
                                            <dxg:GridColumn FieldName="TransAmount"
                                                            Header="Amount" />
                                            <dxg:GridColumn FieldName="TransDesc"
                                                            Header="Description" />
                                        </dxg:GridControl.Columns>
                                    </dxg:GridControl>
                                </GroupBox>
                            </Grid>
                        </DataTemplate>
                    </dxg:ContentDetailDescriptor.ContentTemplate>
                </dxg:ContentDetailDescriptor>
            </dxg:GridControl.DetailDescriptor>
        </dxg:GridControl>

        <!-- Summary -->
        <StackPanel Orientation="Horizontal"
                    Margin="0,10"
                    HorizontalAlignment="Right">
            <TextBlock Text="Total Invoice: ₹"
                       FontWeight="Bold" />
            <TextBlock Text="{Binding TotalInvoiceAmount}"
                       Margin="5,0" />
            <TextBlock Text="Paid: ₹"
                       FontWeight="Bold"
                       Margin="20,0" />
            <TextBlock Text="{Binding TotalVoucherAmount}"
                       Margin="5,0" />
            <TextBlock Text="Balance: ₹"
                       FontWeight="Bold"
                       Margin="20,0" />
            <TextBlock Text="{Binding BalanceAmount}"
                       Foreground="Red"
                       Margin="5,0" />
        </StackPanel>

        <Button Content="Save Invoice Vouchers"
                Command="{Binding SaveCommand}"
                Background="Green"
                Foreground="White"
                Width="250"
                Height="40" />

    </Grid>

</UserControl>
